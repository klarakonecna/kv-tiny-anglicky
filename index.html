<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rostliny ‚Äì uƒçen√≠ + p≈ôi≈ôazov√°n√≠</title>
<style>
  body{
    font-family: Sitka Text, sans-serif;
    background:#DA70D6;
    text-align:center;
    padding:30px;
  }
  h1{ color:#FFFFFF; margin-bottom:10px; }
  .card{
    background:pink;
    padding:20px;
    max-width:820px;
    margin:auto;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  .row{
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  select, .smallBtn{
    padding:10px;
    border:none;
    border-radius:8px;
    font-size:14px;
  }
  select{ min-width:220px; }
  .smallBtn{
    background:#8000FF;
    color:white;
    cursor:pointer;
  }
  .smallBtn:hover{ background:#DA70D6; }

  .tabs{
    display:flex;
    gap:10px;
    justify-content:center;
    margin:10px 0 16px;
    flex-wrap:wrap;
  }
  .tabBtn{
    padding:10px 14px;
    border:none;
    border-radius:999px;
    cursor:pointer;
    background:rgba(255,255,255,0.55);
    font-size:14px;
  }
  .tabBtn.active{
    background:#8000FF;
    color:white;
  }

  /* ===== Quiz buttons ===== */
  button.optionBtn{
    display:block;
    margin:10px auto;
    padding:10px;
    width:100%;
    border:none;
    border-radius:8px;
    background:#8000FF;
    color:white;
    font-size:16px;
    cursor:pointer;
  }
  button.optionBtn:hover{ background:#DA70D6; }
  button.optionBtn:disabled{ opacity:0.78; cursor:not-allowed; }

  /* ===== Image options ===== */
  .imgGrid{
    display:grid;
    grid-template-columns: repeat(2, minmax(140px, 1fr));
    gap:12px;
    margin-top:10px;
  }
  .imgBtn{
    border:none;
    border-radius:12px;
    background:#8000FF;
    cursor:pointer;
    padding:10px;
    width:100%;
    display:flex;
    flex-direction:column;
    gap:8px;
    align-items:center;
  }
  .imgBtn:hover{ background:#DA70D6; }
  .imgBtn:disabled{ opacity:0.78; cursor:not-allowed; }
  .imgBtn img{
    width:100%;
    aspect-ratio: 4 / 3;
    object-fit:cover;
    border-radius:10px;
    background:rgba(255,255,255,0.25);
  }
  .imgCaption{
    font-size:13px;
    color:white;
    opacity:0.9;
  }

  #result{ margin-top:15px; font-weight:bold; }

  .stats{ margin-top:10px; }
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,0.5);
    font-size:13px;
  }
  .hint{
    margin:6px 0 0;
    font-size:13px;
    opacity:0.85;
  }

  /* ===== Study mode ===== */
  .studyWrap{
    display:grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap:14px;
    margin-top:12px;
  }
  @media (max-width: 820px){
    .studyWrap{ grid-template-columns: 1fr; }
  }
  .studyCard{
    background:rgba(255,255,255,0.6);
    border-radius:14px;
    padding:14px;
    text-align:left;
  }
  .studyTop{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }
  .studyTitle{
    font-weight:bold;
    font-size:16px;
  }
  .studyImg{
    width:100%;
    aspect-ratio: 16 / 10;
    object-fit:cover;
    border-radius:12px;
    margin:12px 0;
    background:rgba(255,255,255,0.25);
  }
  .studyGrid{
    display:grid;
    grid-template-columns: 120px 1fr;
    gap:8px 12px;
    font-size:14px;
  }
  .studyLabel{ opacity:0.75; }
  .studyValue{ font-weight:600; }

  .studySide{
    background:rgba(255,255,255,0.45);
    border-radius:14px;
    padding:14px;
    text-align:left;
  }
  .studySide h3{
    margin:0 0 10px;
    font-size:15px;
  }
  .studyList{
    max-height:320px;
    overflow:auto;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .studyItem{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    padding:10px;
    border-radius:10px;
    background:rgba(255,255,255,0.55);
    cursor:pointer;
  }
  .studyItem.active{ outline:2px solid #8000FF; }
  .studyItem small{ opacity:0.75; display:block; }

  .hiddenAnswer .studyValue{ filter: blur(7px); user-select:none; }
</style>
</head>
<body>

<h1>Rostliny ‚Äì uƒçen√≠ + kv√≠z</h1>

<div class="card">
  <div class="row">
    <select id="category"></select>

    <select id="quizType">
      <option value="classic">Z angliƒçtiny do ƒçe≈°tiny</option>
      <option value="ultimate" selected>N√°hodnƒõ (EN/CZ/rod/druh)</option>
      <option value="images">Anglicky ‚Üí obr√°zek</option>
    </select>

    <select id="modeClassic">
      <option value="cz">Odpovƒõƒè: ƒçesk√Ω n√°zev</option>
      <option value="genus">Odpovƒõƒè: rod (Genus)</option>
      <option value="species">Odpovƒõƒè: druh (latinsky)</option>
    </select>

    <button class="smallBtn" id="resetBtn">Reset</button>
  </div>

  <div class="tabs">
    <button class="tabBtn active" id="tabStudy">Uƒçen√≠ (slov√≠ƒçka)</button>
    <button class="tabBtn" id="tabQuiz">Kv√≠z (p≈ôi≈ôazov√°n√≠)</button>
  </div>

  <div class="row">
    <span class="pill">Poƒçet v sadƒõ: <span id="setCount">0</span></span>
    <span class="pill">Sada: <span id="setName">‚Äì</span></span>
    <span class="pill">Ot√°zka: <span id="qType">‚Äì</span></span>
    <span class="pill">Hled√°m: <span id="aType">‚Äì</span></span>
  </div>

  <!-- ===== STUDY VIEW ===== -->
  <div id="studyView">
    <div class="row">
      <button class="smallBtn" id="prevCardBtn">‚óÄ P≈ôedchoz√≠</button>
      <button class="smallBtn" id="flipBtn">üëÅÔ∏è Skr√Ωt/uk√°zat odpovƒõdi</button>
      <button class="smallBtn" id="nextCardBtn">Dal≈°√≠ ‚ñ∂</button>
    </div>

    <div class="studyWrap">
      <div class="studyCard" id="studyCard">
        <div class="studyTop">
          <div class="studyTitle" id="studyTitle">‚Äì</div>
          <div class="pill">Kartiƒçka: <span id="studyIndex">0</span>/<span id="studyTotal">0</span></div>
        </div>

        <img class="studyImg" id="studyImg" alt="Obr√°zek rostliny" />

        <div class="studyGrid" id="studyGrid">
          <!-- vypln√≠ se JS -->
        </div>

        <div class="hint" style="margin-top:10px;">
          Tip: klikni na polo≈æku v seznamu pro rychl√Ω v√Ωbƒõr.
        </div>
      </div>

      <div class="studySide">
        <h3>Seznam ve vybran√© sadƒõ</h3>
        <div class="studyList" id="studyList"></div>
      </div>
    </div>
  </div>

  <!-- ===== QUIZ VIEW ===== -->
  <div id="quizView" style="display:none;">
    <h2 id="questionText"></h2>
    <div class="hint" id="hintText"></div>

    <div id="options"></div>
    <p id="result"></p>

    <div class="stats">
      Spr√°vnƒõ: <span id="score">0</span> |
      ≈†patnƒõ: <span id="wrong">0</span>
    </div>
  </div>
</div>

<script>
// ===== Pomocn√° funkce ‚Äì z n√°zvu souboru na Wikimedia Commons vytvo≈ô√≠ p≈ô√≠mou URL =====
function commonsFile(fileName){
  // Koment√°≈ô: P≈ôes Special:FilePath se d√° pou≈æ√≠t obr√°zek p≈ô√≠mo jako URL.
  return "https://commons.wikimedia.org/wiki/Special:FilePath/" + encodeURIComponent(fileName);
}

// ===================== DATA =====================
// Koment√°≈ô: Ka≈æd√° polo≈æka m√° img (Wikimedia Commons). Klidnƒõ si to pozdƒõji vymƒõ≈à za vlastn√≠ fotky.
const datasets = {
  "Letniƒçky": [
    { en:"Petunia", cz:"Pet√∫nie", genus:"Petunia", species:"Petunia √ó atkinsiana", img: commonsFile("Petunia √óatkinsiana.jpg") },
    { en:"Zinnia", cz:"C√≠nie", genus:"Zinnia", species:"Zinnia elegans", img: commonsFile("Zinnia elegans.jpg") },
    { en:"Marigold", cz:"Aksamitn√≠k", genus:"Tagetes", species:"Tagetes patula", img: commonsFile("Tagetes patula.jpg") },
    { en:"Cosmos", cz:"Kr√°senka", genus:"Cosmos", species:"Cosmos bipinnatus", img: commonsFile("Cosmos bipinnatus1.jpg") },
    { en:"Sunflower", cz:"Sluneƒçnice", genus:"Helianthus", species:"Helianthus annuus", img: commonsFile("Helianthus annuus.jpg") },
    { en:"Impatiens", cz:"Net√Ωkavka", genus:"Impatiens", species:"Impatiens walleriana", img: commonsFile("Impatiens walleriana.JPG") },
    { en:"Nasturtium", cz:"Licho≈ôe≈ôi≈°nice", genus:"Tropaeolum", species:"Tropaeolum majus", img: commonsFile("Tropaeolum majus.JPG") },
    { en:"Snapdragon", cz:"Hled√≠k", genus:"Antirrhinum", species:"Antirrhinum majus", img: commonsFile("Antirrhinum majus.jpg") }
  ],
  "Trvalky": [
    { en:"Peony", cz:"Pivo≈àka", genus:"Paeonia", species:"Paeonia lactiflora", img: commonsFile("Paeonia lactiflora.jpg") },
    { en:"Lavender", cz:"Levandule", genus:"Lavandula", species:"Lavandula angustifolia", img: commonsFile("Lavandula angustifolia.jpg") },
    { en:"Iris", cz:"Kosatec", genus:"Iris", species:"Iris germanica", img: commonsFile("Iris germanica.jpg") },
    { en:"Dahlia", cz:"Ji≈ôina", genus:"Dahlia", species:"Dahlia pinnata", img: commonsFile("Dahlia pinnata.JPG") },
    { en:"Chrysanthemum", cz:"Chryzant√©ma", genus:"Chrysanthemum", species:"Chrysanthemum morifolium", img: commonsFile("Chrysanthemum morifolium.jpg") },
    { en:"Yarrow", cz:"≈òeb≈ô√≠ƒçek", genus:"Achillea", species:"Achillea millefolium", img: commonsFile("Achillea millefolium.jpg") },
    { en:"Foxglove", cz:"N√°prstn√≠k", genus:"Digitalis", species:"Digitalis purpurea", img: commonsFile("Digitalis purpurea.jpg") },
    { en:"Hydrangea", cz:"Hortenzie", genus:"Hydrangea", species:"Hydrangea macrophylla", img: commonsFile("Hydrangea macrophylla 01.jpg") }
  ],
  "Ovocn√© stromy": [
    { en:"Apple tree", cz:"Jablo≈à", genus:"Malus", species:"Malus domestica", img: commonsFile("Malus domestica 001.jpg") },
    { en:"Pear tree", cz:"Hru≈°e≈à", genus:"Pyrus", species:"Pyrus communis", img: commonsFile("Pyrus communis.jpg") },
    { en:"Plum tree", cz:"Slivo≈à", genus:"Prunus", species:"Prunus domestica", img: commonsFile("Prunus domestica.jpg") },
    { en:"Cherry tree", cz:"T≈ôe≈°e≈à", genus:"Prunus", species:"Prunus avium", img: commonsFile("Prunus avium.jpg") },
    { en:"Sour cherry tree", cz:"Vi≈°e≈à", genus:"Prunus", species:"Prunus cerasus", img: commonsFile("Prunus cerasus.jpg") },
    { en:"Apricot tree", cz:"Meru≈àka", genus:"Prunus", species:"Prunus armeniaca", img: commonsFile("Prunus armeniaca.jpg") },
    { en:"Peach tree", cz:"Broskvo≈à", genus:"Prunus", species:"Prunus persica", img: commonsFile("Prunus persica.jpg") },
    { en:"Walnut tree", cz:"O≈ôe≈°√°k vla≈°sk√Ω", genus:"Juglans", species:"Juglans regia", img: commonsFile("Juglans regia.jpg") }
  ],
  "Jehliƒçnat√© stromy": [
    { en:"Norway spruce", cz:"Smrk ztepil√Ω", genus:"Picea", species:"Picea abies", img: commonsFile("Picea abies.jpg") },
    { en:"Scots pine", cz:"Borovice lesn√≠", genus:"Pinus", species:"Pinus sylvestris", img: commonsFile("Pinus sylvestris.jpg") },
    { en:"Silver fir", cz:"Jedle bƒõlokor√°", genus:"Abies", species:"Abies alba", img: commonsFile("Abies alba.jpg") },
    { en:"European larch", cz:"Mod≈ô√≠n opadav√Ω", genus:"Larix", species:"Larix decidua", img: commonsFile("Larix decidua.JPG") },
    { en:"Yew", cz:"Tis", genus:"Taxus", species:"Taxus baccata", img: commonsFile("Taxus baccata.jpg") },
    { en:"Juniper", cz:"Jalovec", genus:"Juniperus", species:"Juniperus communis", img: commonsFile("Juniperus communis.jpg") },
    { en:"Thuja", cz:"T√∫je (zerav)", genus:"Thuja", species:"Thuja occidentalis", img: commonsFile("Thuja occidentalis.jpg") }
  ],
  "Listnat√© stromy": [
    { en:"Oak", cz:"Dub", genus:"Quercus", species:"Quercus robur", img: commonsFile("Quercus robur.jpg") },
    { en:"Beech", cz:"Buk", genus:"Fagus", species:"Fagus sylvatica", img: commonsFile("Fagus sylvatica.jpg") },
    { en:"Birch", cz:"B≈ô√≠za", genus:"Betula", species:"Betula pendula", img: commonsFile("Betula pendula.JPG") },
    { en:"Maple", cz:"Javor", genus:"Acer", species:"Acer platanoides", img: commonsFile("Acer platanoides.jpg") },
    { en:"Linden", cz:"L√≠pa", genus:"Tilia", species:"Tilia cordata", img: commonsFile("Tilia cordata.jpg") },
    { en:"Ash", cz:"Jasan", genus:"Fraxinus", species:"Fraxinus excelsior", img: commonsFile("Fraxinus excelsior.jpg") },
    { en:"Elm", cz:"Jilm", genus:"Ulmus", species:"Ulmus glabra", img: commonsFile("Ulmus glabra.jpg") },
    { en:"Hornbeam", cz:"Habr", genus:"Carpinus", species:"Carpinus betulus", img: commonsFile("Carpinus betulus.jpg") },
    { en:"Poplar", cz:"Topol", genus:"Populus", species:"Populus tremula", img: commonsFile("Populus tremula.JPG") },
    { en:"Willow", cz:"Vrba", genus:"Salix", species:"Salix alba", img: commonsFile("Salix alba.jpg") }
  ]
};

// ====== DOM ======
const categoryEl = document.getElementById("category");
const quizTypeEl = document.getElementById("quizType");
const modeClassicEl = document.getElementById("modeClassic");
const resetBtnEl = document.getElementById("resetBtn");

const setCountEl = document.getElementById("setCount");
const setNameEl = document.getElementById("setName");
const qTypeEl = document.getElementById("qType");
const aTypeEl = document.getElementById("aType");

const tabStudyEl = document.getElementById("tabStudy");
const tabQuizEl = document.getElementById("tabQuiz");
const studyViewEl = document.getElementById("studyView");
const quizViewEl = document.getElementById("quizView");

// Study DOM
const prevCardBtn = document.getElementById("prevCardBtn");
const nextCardBtn = document.getElementById("nextCardBtn");
const flipBtn = document.getElementById("flipBtn");
const studyTitleEl = document.getElementById("studyTitle");
const studyIndexEl = document.getElementById("studyIndex");
const studyTotalEl = document.getElementById("studyTotal");
const studyImgEl = document.getElementById("studyImg");
const studyGridEl = document.getElementById("studyGrid");
const studyListEl = document.getElementById("studyList");
const studyCardEl = document.getElementById("studyCard");

// Quiz DOM
const scoreEl = document.getElementById("score");
const wrongEl = document.getElementById("wrong");
const questionTextEl = document.getElementById("questionText");
const optionsEl = document.getElementById("options");
const resultEl = document.getElementById("result");
const hintTextEl = document.getElementById("hintText");

// ====== Stav ======
let correct = 0;
let wrong = 0;
let locked = false;

let currentItem = null;
let currentQKey = null;
let currentAKey = null;

let studyIndex = 0;
let hideAnswers = false;

const DELAY_MS = 3500;
const KEYS = ["en", "cz", "genus", "species"];

const LABELS = {
  en: "EN",
  cz: "CZ",
  genus: "Rod",
  species: "Druh",
  img: "Obr√°zek"
};

// ====== Helpers ======
function shuffleInPlace(arr){
  // Koment√°≈ô: Spolehliv√© m√≠ch√°n√≠ (Fisher‚ÄìYates).
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function shuffledCopy(arr){
  // Koment√°≈ô: Vr√°t√≠ novou prom√≠chanou kopii pole.
  return shuffleInPlace([...arr]);
}

function initCategories(){
  categoryEl.innerHTML = "";

  const allOpt = document.createElement("option");
  allOpt.value = "__ALL__";
  allOpt.textContent = "V≈°e dohromady";
  categoryEl.appendChild(allOpt);

  Object.keys(datasets).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    categoryEl.appendChild(opt);
  });

  categoryEl.value = "__ALL__";
}

function getAllWords(){
  return Object.values(datasets).flat();
}

function getActiveWords(){
  if (categoryEl.value === "__ALL__") return getAllWords();
  return datasets[categoryEl.value] || [];
}

function renderSetInfo(active){
  setCountEl.textContent = active.length;
  setNameEl.textContent = (categoryEl.value === "__ALL__") ? "V≈†E DOHROMADY" : categoryEl.value;
}

function setModeClassicVisibility(){
  // Koment√°≈ô: Volba c√≠le odpovƒõdi je relevantn√≠ jen pro "classic".
  modeClassicEl.style.display = (quizTypeEl.value === "classic") ? "" : "none";
}

function setActiveTab(tab){
  // Koment√°≈ô: P≈ôep√≠n√°n√≠ mezi uƒçen√≠m a kv√≠zem.
  const isStudy = tab === "study";
  tabStudyEl.classList.toggle("active", isStudy);
  tabQuizEl.classList.toggle("active", !isStudy);
  studyViewEl.style.display = isStudy ? "" : "none";
  quizViewEl.style.display = isStudy ? "none" : "";
}

// ====== STUDY MODE ======
function buildStudyList(active){
  // Koment√°≈ô: Vykresl√≠ seznam polo≈æek v sadƒõ (kliknut√≠m p≈ôejde≈° na kartiƒçku).
  studyListEl.innerHTML = "";
  active.forEach((item, idx) => {
    const el = document.createElement("div");
    el.className = "studyItem";
    el.dataset.idx = String(idx);

    const left = document.createElement("div");
    left.innerHTML = `<strong>${item.en}</strong><small>${item.cz}</small>`;

    const right = document.createElement("div");
    right.innerHTML = `<small>${item.genus}</small>`;

    el.appendChild(left);
    el.appendChild(right);

    el.onclick = () => {
      studyIndex = idx;
      renderStudyCard();
    };

    studyListEl.appendChild(el);
  });
}

function renderStudyCard(){
  const active = getActiveWords();
  if (active.length === 0){
    studyTitleEl.textContent = "≈Ω√°dn√° data";
    studyImgEl.removeAttribute("src");
    studyGridEl.innerHTML = "";
    studyIndexEl.textContent = "0";
    studyTotalEl.textContent = "0";
    return;
  }

  // Koment√°≈ô: Hl√≠d√°n√≠ indexu.
  if (studyIndex < 0) studyIndex = 0;
  if (studyIndex > active.length - 1) studyIndex = active.length - 1;

  const item = active[studyIndex];

  // zv√Ωraznƒõn√≠ v seznamu
  [...studyListEl.children].forEach((node, idx) => {
    node.classList.toggle("active", idx === studyIndex);
  });

  studyTitleEl.textContent = `${item.en}  ‚Üí  ${item.cz}`;
  studyIndexEl.textContent = String(studyIndex + 1);
  studyTotalEl.textContent = String(active.length);
  studyImgEl.src = item.img;

  // Koment√°≈ô: Obsah kartiƒçky ‚Äì to je ten ‚Äûobsah slov√≠ƒçek‚Äú k uƒçen√≠.
  studyGridEl.innerHTML = `
    <div class="studyLabel">EN</div><div class="studyValue">${item.en}</div>
    <div class="studyLabel">CZ</div><div class="studyValue">${item.cz}</div>
    <div class="studyLabel">Rod</div><div class="studyValue">${item.genus}</div>
    <div class="studyLabel">Druh</div><div class="studyValue">${item.species}</div>
  `;

  // Skryt√≠/uk√°z√°n√≠ odpovƒõd√≠ (rozmaz√°n√≠ hodnot)
  studyCardEl.classList.toggle("hiddenAnswer", hideAnswers);

  // info pilulky (nech√°me smyslupln√© i v uƒçen√≠)
  qTypeEl.textContent = "‚Äì";
  aTypeEl.textContent = "‚Äì";
}

function resetStudy(){
  // Koment√°≈ô: Reset uƒçen√≠ p≈ôi zmƒõnƒõ sady ‚Äì vr√°t√≠ tƒõ na prvn√≠ kartiƒçku.
  studyIndex = 0;
  hideAnswers = false;
  const active = getActiveWords();
  buildStudyList(active);
  renderStudyCard();
}

// ====== QUIZ MODE ======
function pickDifferentKey(fromKey){
  const candidates = KEYS.filter(k => k !== fromKey);
  return candidates[Math.floor(Math.random() * candidates.length)];
}

function buildRound(active){
  const quizType = quizTypeEl.value;
  currentItem = active[Math.floor(Math.random() * active.length)];

  if (quizType === "classic"){
    currentQKey = "en";
    currentAKey = modeClassicEl.value;
  } else if (quizType === "ultimate"){
    currentQKey = KEYS[Math.floor(Math.random() * KEYS.length)];
    currentAKey = pickDifferentKey(currentQKey);
  } else if (quizType === "images"){
    currentQKey = "en";
    currentAKey = "img";
  }
}

function renderQuestion(){
  questionTextEl.textContent = currentItem[currentQKey];

  qTypeEl.textContent = LABELS[currentQKey] || "‚Äì";
  aTypeEl.textContent = LABELS[currentAKey] || "‚Äì";

  if (quizTypeEl.value === "images"){
    hintTextEl.textContent = "Klikni na obr√°zek, kter√Ω odpov√≠d√° anglick√©mu n√°zvu.";
  } else {
    hintTextEl.textContent = `Vyber spr√°vn√Ω ${LABELS[currentAKey]} pro zadan√Ω ${LABELS[currentQKey]}.`;
  }
}

function buildOptionsText(active){
  const correctAnswer = currentItem[currentAKey];
  const opts = [correctAnswer];

  const attemptsMax = 200;
  let attempts = 0;

  while (opts.length < 4 && attempts < attemptsMax){
    attempts++;
    const candidate = active[Math.floor(Math.random() * active.length)]?.[currentAKey];
    if (candidate && !opts.includes(candidate)) opts.push(candidate);
  }

  const shuffled = shuffledCopy(opts);

  optionsEl.innerHTML = "";
  shuffled.forEach(text => {
    const btn = document.createElement("button");
    btn.className = "optionBtn";
    btn.textContent = text;
    btn.style.background = "";
    btn.disabled = false;
    btn.onclick = () => checkAnswerText(text);
    optionsEl.appendChild(btn);
  });
}

function buildOptionsImages(active){
  const correctItem = currentItem;
  const picks = [correctItem];

  const attemptsMax = 300;
  let attempts = 0;

  while (picks.length < 4 && attempts < attemptsMax){
    attempts++;
    const cand = active[Math.floor(Math.random() * active.length)];
    if (cand && !picks.includes(cand)) picks.push(cand);
  }

  const shuffled = shuffledCopy(picks);

  optionsEl.innerHTML = "";
  const grid = document.createElement("div");
  grid.className = "imgGrid";

  shuffled.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "imgBtn";
    btn.dataset.key = item.en;

    const img = document.createElement("img");
    img.src = item.img;
    img.alt = item.cz || item.en || "Rostlina";

    const cap = document.createElement("div");
    cap.className = "imgCaption";
    cap.textContent = "Vybrat";

    btn.appendChild(img);
    btn.appendChild(cap);

    btn.onclick = () => checkAnswerImage(item);
    grid.appendChild(btn);
  });

  optionsEl.appendChild(grid);
}

function nextWord(){
  locked = false;
  resultEl.textContent = "";

  const active = getActiveWords();

  if (active.length < 4){
    questionTextEl.textContent = "Vybran√° sada m√° m√©nƒõ ne≈æ 4 polo≈æky.";
    optionsEl.innerHTML = "";
    qTypeEl.textContent = "‚Äì";
    aTypeEl.textContent = "‚Äì";
    hintTextEl.textContent = "";
    renderSetInfo(active);
    return;
  }

  buildRound(active);
  renderQuestion();

  if (quizTypeEl.value === "images"){
    buildOptionsImages(active);
  } else {
    buildOptionsText(active);
  }

  renderSetInfo(active);
}

function checkAnswerText(answer){
  if (locked) return;
  locked = true;

  const correctAnswer = currentItem[currentAKey];
  const buttons = document.querySelectorAll(".optionBtn");

  buttons.forEach(btn => {
    if (btn.textContent === correctAnswer) btn.style.background = "#2ecc71";
    else if (btn.textContent === answer) btn.style.background = "#e74c3c";
    btn.disabled = true;
  });

  if (answer === correctAnswer){
    correct++;
    resultEl.textContent = "Spr√°vnƒõ ‚úÖ";
  } else {
    wrong++;
    resultEl.textContent = "≈†patnƒõ ‚ùå Spr√°vnƒõ: " + correctAnswer;
  }

  scoreEl.textContent = correct;
  wrongEl.textContent = wrong;

  setTimeout(nextWord, DELAY_MS);
}

function checkAnswerImage(chosenItem){
  if (locked) return;
  locked = true;

  const correctItem = currentItem;
  const buttons = document.querySelectorAll(".imgBtn");

  buttons.forEach(btn => {
    const isCorrect = btn.dataset.key === correctItem.en;
    const isChosen  = btn.dataset.key === chosenItem.en;

    if (isCorrect) btn.style.background = "#2ecc71";
    else if (isChosen) btn.style.background = "#e74c3c";
    btn.disabled = true;
  });

  if (chosenItem === correctItem){
    correct++;
    resultEl.textContent = "Spr√°vnƒõ ‚úÖ";
  } else {
    wrong++;
    resultEl.textContent = `≈†patnƒõ ‚ùå Spr√°vnƒõ je: ${correctItem.cz} (${correctItem.en})`;
  }

  scoreEl.textContent = correct;
  wrongEl.textContent = wrong;

  setTimeout(nextWord, DELAY_MS);
}

function resetQuiz(){
  // Koment√°≈ô: Reset sk√≥re a zaƒçni znovu v kv√≠zu.
  correct = 0;
  wrong = 0;
  scoreEl.textContent = 0;
  wrongEl.textContent = 0;
  nextWord();
}

function resetAll(){
  // Koment√°≈ô: Resetuje uƒçen√≠ i kv√≠z (kdy≈æ zmƒõn√≠≈° sadu/re≈æim).
  resetStudy();
  resetQuiz();
}

// ====== Events ======
tabStudyEl.onclick = () => { setActiveTab("study"); resetStudy(); };
tabQuizEl.onclick  = () => { setActiveTab("quiz");  resetQuiz(); };

prevCardBtn.onclick = () => { studyIndex--; renderStudyCard(); };
nextCardBtn.onclick = () => { studyIndex++; renderStudyCard(); };
flipBtn.onclick = () => { hideAnswers = !hideAnswers; renderStudyCard(); };

resetBtnEl.onclick = resetAll;

categoryEl.onchange = () => { renderSetInfo(getActiveWords()); resetAll(); };
quizTypeEl.onchange = () => { setModeClassicVisibility(); resetQuiz(); };
modeClassicEl.onchange = () => { if (quizTypeEl.value === "classic") resetQuiz(); };

// ====== Start ======
initCategories();
setModeClassicVisibility();
renderSetInfo(getActiveWords());
setActiveTab("study");
resetAll();
</script>

</body>
</html>
