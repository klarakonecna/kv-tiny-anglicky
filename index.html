<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rostliny – přiřazování (ultimátní režim)</title>
<style>
  body{
    font-family: Sitka Text, sans-serif;
    background:#DA70D6;
    text-align:center;
    padding:30px;
  }
  h1{ color:#FFFFFF; margin-bottom:10px; }
  .card{
    background:pink;
    padding:20px;
    max-width:720px;
    margin:auto;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  .row{
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  select, .smallBtn{
    padding:10px;
    border:none;
    border-radius:8px;
    font-size:14px;
  }
  select{ min-width:220px; }
  .smallBtn{
    background:#8000FF;
    color:white;
    cursor:pointer;
  }
  .smallBtn:hover{ background:#DA70D6; }

  button.optionBtn{
    display:block;
    margin:10px auto;
    padding:10px;
    width:100%;
    border:none;
    border-radius:8px;
    background:#8000FF;
    color:white;
    font-size:16px;
    cursor:pointer;
  }
  button.optionBtn:hover{ background:#DA70D6; }
  button.optionBtn:disabled{ opacity:0.78; cursor:not-allowed; }

  /* === Obrázkové možnosti === */
  .imgGrid{
    display:grid;
    grid-template-columns: repeat(2, minmax(140px, 1fr));
    gap:12px;
    margin-top:10px;
  }
  .imgBtn{
    border:none;
    border-radius:12px;
    background:#8000FF;
    cursor:pointer;
    padding:10px;
    width:100%;
    display:flex;
    flex-direction:column;
    gap:8px;
    align-items:center;
  }
  .imgBtn:hover{ background:#DA70D6; }
  .imgBtn:disabled{ opacity:0.78; cursor:not-allowed; }
  .imgBtn img{
    width:100%;
    aspect-ratio: 4 / 3;
    object-fit:cover;
    border-radius:10px;
    background:rgba(255,255,255,0.25);
  }
  .imgCaption{
    font-size:13px;
    color:white;
    opacity:0.9;
  }

  #result{ margin-top:15px; font-weight:bold; }
  .stats{ margin-top:10px; }
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,0.5);
    font-size:13px;
  }
  .hint{
    margin:6px 0 0;
    font-size:13px;
    opacity:0.85;
  }
</style>
</head>
<body>

<h1>Rostliny – přiřazování</h1>

<div class="card">
  <div class="row">
    <select id="category"></select>

    <select id="quizType">
      <option value="classic">Z angličtiny do češtiny</option>
      <option value="ultimate" selected>Náhodně (EN/CZ/rod/druh)</option>
      <option value="images">Anglicky → obrázek</option>
    </select>

    <select id="modeClassic">
      <option value="cz">Odpověď: český název</option>
      <option value="genus">Odpověď: rod (Genus)</option>
      <option value="species">Odpověď: druh (latinsky)</option>
    </select>

    <button class="smallBtn" id="resetBtn">Reset</button>
  </div>

  <div class="row">
    <span class="pill">Počet v sadě: <span id="setCount">0</span></span>
    <span class="pill">Sada: <span id="setName">–</span></span>
    <span class="pill">Otázka: <span id="qType">–</span></span>
    <span class="pill">Hledám: <span id="aType">–</span></span>
  </div>

  <h2 id="questionText"></h2>
  <div class="hint" id="hintText"></div>

  <div id="options"></div>
  <p id="result"></p>

  <div class="stats">
    Správně: <span id="score">0</span> |
    Špatně: <span id="wrong">0</span>
  </div>
</div>

<script>
function commonsFile(fileName){
  return "https://commons.wikimedia.org/wiki/Special:FilePath/" + encodeURIComponent(fileName);
}

const datasets = {
  "Letničky": [
    { en:"Petunia", cz:"Petúnie", genus:"Petunia", species:"Petunia × atkinsiana", img: commonsFile("Petunia ×atkinsiana.jpg") },
    { en:"Zinnia", cz:"Cínie", genus:"Zinnia", species:"Zinnia elegans", img: commonsFile("Zinnia elegans.jpg") },
    { en:"Marigold", cz:"Aksamitník", genus:"Tagetes", species:"Tagetes patula", img: commonsFile("Tagetes patula.jpg") },
    { en:"Cosmos", cz:"Krásenka", genus:"Cosmos", species:"Cosmos bipinnatus", img: commonsFile("Cosmos bipinnatus1.jpg") },
    { en:"Sunflower", cz:"Slunečnice", genus:"Helianthus", species:"Helianthus annuus", img: commonsFile("Helianthus annuus.jpg") },
    { en:"Impatiens", cz:"Netýkavka", genus:"Impatiens", species:"Impatiens walleriana", img: commonsFile("Impatiens walleriana.JPG") },
    { en:"Nasturtium", cz:"Lichořeřišnice", genus:"Tropaeolum", species:"Tropaeolum majus", img: commonsFile("Tropaeolum majus.JPG") },
    { en:"Snapdragon", cz:"Hledík", genus:"Antirrhinum", species:"Antirrhinum majus", img: commonsFile("Antirrhinum Majus.jpg") }
  ],
  "Trvalky": [
    { en:"Peony", cz:"Pivoňka", genus:"Paeonia", species:"Paeonia lactiflora", img: commonsFile("Paeonia lactiflora.jpg") },
    { en:"Lavender", cz:"Levandule", genus:"Lavandula", species:"Lavandula angustifolia", img: commonsFile("Lavandula Angustifolia.jpg") },
    { en:"Iris", cz:"Kosatec", genus:"Iris", species:"Iris germanica", img: commonsFile("Iris germanica.jpg") },
    { en:"Dahlia", cz:"Jiřina", genus:"Dahlia", species:"Dahlia pinnata", img: commonsFile("Dahlia pinnata.JPG") },
    { en:"Chrysanthemum", cz:"Chryzantéma", genus:"Chrysanthemum", species:"Chrysanthemum morifolium", img: commonsFile("Chrysanthemum morifolium.jpg") },
    { en:"Yarrow", cz:"Řebříček", genus:"Achillea", species:"Achillea millefolium", img: commonsFile("Achillea millefolium.jpg") },
    { en:"Foxglove", cz:"Náprstník", genus:"Digitalis", species:"Digitalis purpurea", img: commonsFile("Digitalis Purpurea.jpg") },
    { en:"Hydrangea", cz:"Hortenzie", genus:"Hydrangea", species:"Hydrangea macrophylla", img: commonsFile("Hydrangea macrophylla 01.jpg") }
  ],
  "Ovocné stromy": [
    { en:"Apple tree", cz:"Jabloň", genus:"Malus", species:"Malus domestica", img: commonsFile("Malus domestica 001.jpg") },
    { en:"Pear tree", cz:"Hrušeň", genus:"Pyrus", species:"Pyrus communis", img: commonsFile("Pyrus communis.jpg") },
    { en:"Plum tree", cz:"Slivoň", genus:"Prunus", species:"Prunus domestica", img: commonsFile("Prunus domestica.jpg") },
    { en:"Cherry tree", cz:"Třešeň", genus:"Prunus", species:"Prunus avium", img: commonsFile("Prunus avium.jpg") },
    { en:"Sour cherry tree", cz:"Višeň", genus:"Prunus", species:"Prunus cerasus", img: commonsFile("Prunus cerasus.jpg") },
    { en:"Apricot tree", cz:"Meruňka", genus:"Prunus", species:"Prunus armeniaca", img: commonsFile("Prunus armeniaca.jpg") },
    { en:"Peach tree", cz:"Broskvoň", genus:"Prunus", species:"Prunus persica", img: commonsFile("Prunus persica.jpg") },
    { en:"Walnut tree", cz:"Ořešák vlašský", genus:"Juglans", species:"Juglans regia", img: commonsFile("Juglans Regia.JPG") }
  ],
  "Jehličnaté stromy": [
    { en:"Norway spruce", cz:"Smrk ztepilý", genus:"Picea", species:"Picea abies", img: commonsFile("Picea abies.jpg") },
    { en:"Scots pine", cz:"Borovice lesní", genus:"Pinus", species:"Pinus sylvestris", img: commonsFile("Pinus sylvestris.jpg") },
    { en:"Silver fir", cz:"Jedle bělokorá", genus:"Abies", species:"Abies alba", img: commonsFile("Abies alba.jpg") },
    { en:"European larch", cz:"Modřín opadavý", genus:"Larix", species:"Larix decidua", img: commonsFile("Larix decidua.JPG") },
    { en:"Yew", cz:"Tis", genus:"Taxus", species:"Taxus baccata", img: commonsFile("Taxus baccata.jpg") },
    { en:"Juniper", cz:"Jalovec", genus:"Juniperus", species:"Juniperus communis", img: commonsFile("Juniperus communis .jpg") },
    { en:"Thuja", cz:"Túje (zerav)", genus:"Thuja", species:"Thuja occidentalis", img: commonsFile("Thuja occidentalis.jpg") }
  ],
  "Listnaté stromy": [
    { en:"Oak", cz:"Dub", genus:"Quercus", species:"Quercus robur", img: commonsFile("Quercus robur.jpg") },
    { en:"Beech", cz:"Buk", genus:"Fagus", species:"Fagus sylvatica", img: commonsFile("Fagus sylvatica.jpg") },
    { en:"Birch", cz:"Bříza", genus:"Betula", species:"Betula pendula", img: commonsFile("Betula pendula.JPG") },
    { en:"Maple", cz:"Javor", genus:"Acer", species:"Acer platanoides", img: commonsFile("Acer platanoides.jpg") },
    { en:"Linden", cz:"Lípa", genus:"Tilia", species:"Tilia cordata", img: commonsFile("Tilia-cordata.JPG") },
    { en:"Ash", cz:"Jasan", genus:"Fraxinus", species:"Fraxinus excelsior", img: commonsFile("Fraxinus excelsior.jpg") },
    { en:"Elm", cz:"Jilm", genus:"Ulmus", species:"Ulmus glabra", img: commonsFile("Ulmus glabra.jpg") },
    { en:"Hornbeam", cz:"Habr", genus:"Carpinus", species:"Carpinus betulus", img: commonsFile("Carpinus betulus.jpg") },
    { en:"Poplar", cz:"Topol", genus:"Populus", species:"Populus tremula", img: commonsFile("Populus tremula.JPG") },
    { en:"Willow", cz:"Vrba", genus:"Salix", species:"Salix alba", img: commonsFile("Salix Alba.jpg") }
  ]
};

const scoreEl = document.getElementById("score");
const wrongEl = document.getElementById("wrong");
const questionTextEl = document.getElementById("questionText");
const optionsEl = document.getElementById("options");
const resultEl = document.getElementById("result");
const setCountEl = document.getElementById("setCount");
const setNameEl = document.getElementById("setName");
const categoryEl = document.getElementById("category");
const quizTypeEl = document.getElementById("quizType");
const modeClassicEl = document.getElementById("modeClassic");
const resetBtnEl = document.getElementById("resetBtn");
const qTypeEl = document.getElementById("qType");
const aTypeEl = document.getElementById("aType");
const hintTextEl = document.getElementById("hintText");

let correct = 0;
let wrong = 0;
let locked = false;

let currentItem = null;
let currentQKey = null;
let currentAKey = null;

const DELAY_MS = 3500; 
const KEYS = ["en", "cz", "genus", "species"];

const LABELS = {
  en: "EN",
  cz: "CZ",
  genus: "Rod",
  species: "Druh",
  img: "Obrázek"
};

function shuffleInPlace(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function shuffledCopy(arr){
  return shuffleInPlace([...arr]);
}

function initCategories(){
  categoryEl.innerHTML = "";

  const allOpt = document.createElement("option");
  allOpt.value = "__ALL__";
  allOpt.textContent = "Vše dohromady";
  categoryEl.appendChild(allOpt);

  Object.keys(datasets).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    categoryEl.appendChild(opt);
  });

  categoryEl.value = "__ALL__";
}

function getAllWords(){
  return Object.values(datasets).flat();
}

function getActiveWords(){
  if (categoryEl.value === "__ALL__") return getAllWords();
  return datasets[categoryEl.value] || [];
}

function renderSetInfo(active){
  setCountEl.textContent = active.length;
  setNameEl.textContent = (categoryEl.value === "__ALL__") ? "VŠE DOHROMADY" : categoryEl.value;
}

function pickDifferentKey(fromKey){
  const candidates = KEYS.filter(k => k !== fromKey);
  return candidates[Math.floor(Math.random() * candidates.length)];
}

function setModeClassicVisibility(){
  modeClassicEl.style.display = (quizTypeEl.value === "classic") ? "" : "none";
}

function buildRound(active){
  const quizType = quizTypeEl.value;

  currentItem = active[Math.floor(Math.random() * active.length)];

  if (quizType === "classic"){
    currentQKey = "en";
    currentAKey = modeClassicEl.value;
  } else if (quizType === "ultimate"){
    currentQKey = KEYS[Math.floor(Math.random() * KEYS.length)];
    currentAKey = pickDifferentKey(currentQKey);
  } else if (quizType === "images"){
    currentQKey = "en";
    currentAKey = "img";
  }
}

function renderQuestion(){
  questionTextEl.textContent = currentItem[currentQKey];

  qTypeEl.textContent = LABELS[currentQKey] || "–";
  aTypeEl.textContent = LABELS[currentAKey] || "–";

  if (quizTypeEl.value === "images"){
    hintTextEl.textContent = "Klikni na obrázek, který odpovídá anglickému názvu.";
  } else {
    hintTextEl.textContent = `Vyber správný ${LABELS[currentAKey]} pro zadaný ${LABELS[currentQKey]}.`;
  }
}

function buildOptionsText(active){
  const correctAnswer = currentItem[currentAKey];
  const opts = [correctAnswer];

  const attemptsMax = 200;
  let attempts = 0;

  while (opts.length < 4 && attempts < attemptsMax){
    attempts++;
    const candidate = active[Math.floor(Math.random() * active.length)]?.[currentAKey];
    if (candidate && !opts.includes(candidate)) opts.push(candidate);
  }

  const shuffled = shuffledCopy(opts);

  optionsEl.innerHTML = "";
  shuffled.forEach(text => {
    const btn = document.createElement("button");
    btn.className = "optionBtn";
    btn.textContent = text;

    btn.style.background = "";
    btn.disabled = false;

    btn.onclick = () => checkAnswerText(text);
    optionsEl.appendChild(btn);
  });
}

function buildOptionsImages(active){
  const correctItem = currentItem;
  const picks = [correctItem];

  const attemptsMax = 300;
  let attempts = 0;

  while (picks.length < 4 && attempts < attemptsMax){
    attempts++;
    const cand = active[Math.floor(Math.random() * active.length)];
    if (cand && !picks.includes(cand)) picks.push(cand);
  }

  const shuffled = shuffledCopy(picks);

  optionsEl.innerHTML = "";
  const grid = document.createElement("div");
  grid.className = "imgGrid";

  shuffled.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "imgBtn";
    btn.dataset.key = item.en;

    const img = document.createElement("img");
    img.src = item.img;
    img.alt = item.cz || item.en || "Rostlina";

    const cap = document.createElement("div");
    cap.className = "imgCaption";
    cap.textContent = "Vybrat";

    btn.appendChild(img);
    btn.appendChild(cap);

    btn.onclick = () => checkAnswerImage(item);
    grid.appendChild(btn);
  });

  optionsEl.appendChild(grid);
}

function nextWord(){
  locked = false;
  resultEl.textContent = "";

  const active = getActiveWords();
  renderSetInfo(active);

  if (active.length < 4){
    questionTextEl.textContent = "Vybraná sada má méně než 4 položky.";
    optionsEl.innerHTML = "";
    qTypeEl.textContent = "–";
    aTypeEl.textContent = "–";
    hintTextEl.textContent = "";
    return;
  }

  buildRound(active);
  renderQuestion();

  if (quizTypeEl.value === "images"){
    buildOptionsImages(active);
  } else {
    buildOptionsText(active);
  }
}

function checkAnswerText(answer){
  if (locked) return;
  locked = true;

  const correctAnswer = currentItem[currentAKey];
  const buttons = document.querySelectorAll(".optionBtn");

  buttons.forEach(btn => {
    if (btn.textContent === correctAnswer) {
      btn.style.background = "#2ecc71";
    } else if (btn.textContent === answer) {
      btn.style.background = "#e74c3c";
    }
    btn.disabled = true;
  });

  if (answer === correctAnswer){
    correct++;
    resultEl.textContent = "Správně ✅";
  } else {
    wrong++;
    resultEl.textContent = "Špatně ❌ Správně: " + correctAnswer;
  }

  scoreEl.textContent = correct;
  wrongEl.textContent = wrong;

  setTimeout(nextWord, DELAY_MS);
}

function checkAnswerImage(chosenItem){
  if (locked) return;
  locked = true;

  const correctItem = currentItem;
  const buttons = document.querySelectorAll(".imgBtn");

  buttons.forEach(btn => {
    const isCorrect = btn.dataset.key === correctItem.en;
    const isChosen  = btn.dataset.key === chosenItem.en;

    if (isCorrect){
      btn.style.background = "#2ecc71";
    } else if (isChosen){
      btn.style.background = "#e74c3c";
    }
    btn.disabled = true;
  });

  if (chosenItem === correctItem){
    correct++;
    resultEl.textContent = "Správně ✅";
  } else {
    wrong++;
    resultEl.textContent = `Špatně ❌ Správně je: ${correctItem.cz} (${correctItem.en})`;
  }

  scoreEl.textContent = correct;
  wrongEl.textContent = wrong;

  setTimeout(nextWord, DELAY_MS);
}

function resetAll(){
  correct = 0;
  wrong = 0;
  scoreEl.textContent = 0;
  wrongEl.textContent = 0;
  nextWord();
}

resetBtnEl.onclick = resetAll;
categoryEl.onchange = resetAll;
quizTypeEl.onchange = () => { setModeClassicVisibility(); resetAll(); };
modeClassicEl.onchange = () => { if (quizTypeEl.value === "classic") resetAll(); };

initCategories();
setModeClassicVisibility();
resetAll();
</script>

</body>
</html>
