<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rostliny – přiřazování (ultimátní režim)</title>
<style>
  body{
    font-family: Sitka Text, sans-serif;
    background:#DA70D6;
    text-align:center;
    padding:30px;
  }
  h1{ color:#FFFFFF; margin-bottom:10px; }
  .card{
    background:pink;
    padding:20px;
    max-width:640px;
    margin:auto;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  .row{
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  select, .smallBtn{
    padding:10px;
    border:none;
    border-radius:8px;
    font-size:14px;
  }
  select{ min-width:220px; }
  .smallBtn{
    background:#8000FF;
    color:white;
    cursor:pointer;
  }
  .smallBtn:hover{ background:#DA70D6; }
  button.optionBtn{
    display:block;
    margin:10px auto;
    padding:10px;
    width:100%;
    border:none;
    border-radius:8px;
    background:#8000FF;
    color:white;
    font-size:16px;
    cursor:pointer;
  }
  button.optionBtn:hover{ background:#DA70D6; }
  button.optionBtn:disabled{ opacity:0.78; cursor:not-allowed; }
  #result{ margin-top:15px; font-weight:bold; }
  .stats{ margin-top:10px; }
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,0.5);
    font-size:13px;
  }
  .hint{
    margin:6px 0 0;
    font-size:13px;
    opacity:0.85;
  }
</style>
</head>
<body>

<h1>Rostliny – přiřazování</h1>

<div class="card">
  <div class="row">
    <select id="category"></select>

    <select id="quizType">
      <option value="classic">Z angličtiny do češtiny</option>
      <option value="ultimate" selected>Náhodně anglicky/česky/rod/druh)</option>
    </select>

    <select id="modeClassic">
      <option value="cz">Odpověď: český název</option>
      <option value="genus">Odpověď: rod (Genus)</option>
      <option value="species">Odpověď: druh (latinsky)</option>
    </select>

    <button class="smallBtn" id="resetBtn">Reset</button>
  </div>

  <div class="row">
    <span class="pill">Počet v sadě: <span id="setCount">0</span></span>
    <span class="pill">Sada: <span id="setName">–</span></span>
    <span class="pill">Otázka: <span id="qType">–</span></span>
    <span class="pill">Hledám: <span id="aType">–</span></span>
  </div>

  <h2 id="questionText"></h2>
  <div class="hint" id="hintText"></div>

  <div id="options"></div>
  <p id="result"></p>

  <div class="stats">
    Správně: <span id="score">0</span> |
    Špatně: <span id="wrong">0</span>
  </div>
</div>

<script>

const datasets = {
  "Letničky": [
    { en:"Petunia", cz:"Petúnie", genus:"Petunia", species:"Petunia × atkinsiana" },
    { en:"Zinnia", cz:"Cínie", genus:"Zinnia", species:"Zinnia elegans" },
    { en:"Marigold", cz:"Aksamitník", genus:"Tagetes", species:"Tagetes patula" },
    { en:"Cosmos", cz:"Krásenka", genus:"Cosmos", species:"Cosmos bipinnatus" },
    { en:"Sunflower", cz:"Slunečnice", genus:"Helianthus", species:"Helianthus annuus" },
    { en:"Impatiens", cz:"Netýkavka", genus:"Impatiens", species:"Impatiens walleriana" },
    { en:"Nasturtium", cz:"Lichořeřišnice", genus:"Tropaeolum", species:"Tropaeolum majus" },
    { en:"Snapdragon", cz:"Hledík", genus:"Antirrhinum", species:"Antirrhinum majus" }
  ],
  "Trvalky": [
    { en:"Peony", cz:"Pivoňka", genus:"Paeonia", species:"Paeonia lactiflora" },
    { en:"Lavender", cz:"Levandule", genus:"Lavandula", species:"Lavandula angustifolia" },
    { en:"Iris", cz:"Kosatec", genus:"Iris", species:"Iris germanica" },
    { en:"Dahlia", cz:"Jiřina", genus:"Dahlia", species:"Dahlia pinnata" },
    { en:"Chrysanthemum", cz:"Chryzantéma", genus:"Chrysanthemum", species:"Chrysanthemum morifolium" },
    { en:"Yarrow", cz:"Řebříček", genus:"Achillea", species:"Achillea millefolium" },
    { en:"Foxglove", cz:"Náprstník", genus:"Digitalis", species:"Digitalis purpurea" },
    { en:"Hydrangea", cz:"Hortenzie", genus:"Hydrangea", species:"Hydrangea macrophylla" }
  ],
  "Ovocné stromy": [
    { en:"Apple tree", cz:"Jabloň", genus:"Malus", species:"Malus domestica" },
    { en:"Pear tree", cz:"Hrušeň", genus:"Pyrus", species:"Pyrus communis" },
    { en:"Plum tree", cz:"Slivoň", genus:"Prunus", species:"Prunus domestica" },
    { en:"Cherry tree", cz:"Třešeň", genus:"Prunus", species:"Prunus avium" },
    { en:"Sour cherry tree", cz:"Višeň", genus:"Prunus", species:"Prunus cerasus" },
    { en:"Apricot tree", cz:"Meruňka", genus:"Prunus", species:"Prunus armeniaca" },
    { en:"Peach tree", cz:"Broskvoň", genus:"Prunus", species:"Prunus persica" },
    { en:"Walnut tree", cz:"Ořešák vlašský", genus:"Juglans", species:"Juglans regia" }
  ],
  "Jehličnaté stromy": [
    { en:"Norway spruce", cz:"Smrk ztepilý", genus:"Picea", species:"Picea abies" },
    { en:"Scots pine", cz:"Borovice lesní", genus:"Pinus", species:"Pinus sylvestris" },
    { en:"Silver fir", cz:"Jedle bělokorá", genus:"Abies", species:"Abies alba" },
    { en:"European larch", cz:"Modřín opadavý", genus:"Larix", species:"Larix decidua" },
    { en:"Yew", cz:"Tis", genus:"Taxus", species:"Taxus baccata" },
    { en:"Juniper", cz:"Jalovec", genus:"Juniperus", species:"Juniperus communis" },
    { en:"Thuja", cz:"Túje (zerav)", genus:"Thuja", species:"Thuja occidentalis" }
  ],
  "Listnaté stromy": [
    { en:"Oak", cz:"Dub", genus:"Quercus", species:"Quercus robur" },
    { en:"Beech", cz:"Buk", genus:"Fagus", species:"Fagus sylvatica" },
    { en:"Birch", cz:"Bříza", genus:"Betula", species:"Betula pendula" },
    { en:"Maple", cz:"Javor", genus:"Acer", species:"Acer platanoides" },
    { en:"Linden", cz:"Lípa", genus:"Tilia", species:"Tilia cordata" },
    { en:"Ash", cz:"Jasan", genus:"Fraxinus", species:"Fraxinus excelsior" },
    { en:"Elm", cz:"Jilm", genus:"Ulmus", species:"Ulmus glabra" },
    { en:"Hornbeam", cz:"Habr", genus:"Carpinus", species:"Carpinus betulus" },
    { en:"Poplar", cz:"Topol", genus:"Populus", species:"Populus tremula" },
    { en:"Willow", cz:"Vrba", genus:"Salix", species:"Salix alba" }
  ]
};

// ====== DOM ======
const scoreEl = document.getElementById("score");
const wrongEl = document.getElementById("wrong");
const questionTextEl = document.getElementById("questionText");
const optionsEl = document.getElementById("options");
const resultEl = document.getElementById("result");
const setCountEl = document.getElementById("setCount");
const setNameEl = document.getElementById("setName");
const categoryEl = document.getElementById("category");
const quizTypeEl = document.getElementById("quizType");
const modeClassicEl = document.getElementById("modeClassic");
const resetBtnEl = document.getElementById("resetBtn");
const qTypeEl = document.getElementById("qType");
const aTypeEl = document.getElementById("aType");
const hintTextEl = document.getElementById("hintText");

// ====== Stav ======
let correct = 0;
let wrong = 0;
let locked = false;

let currentItem = null;
let currentQKey = null; 
let currentAKey = null; 

const DELAY_MS = 3500; 
const KEYS = ["en", "cz", "genus", "species"];

const LABELS = {
  en: "EN",
  cz: "CZ",
  genus: "Rod",
  species: "Druh"
};

function initCategories(){
  categoryEl.innerHTML = "";

  const allOpt = document.createElement("option");
  allOpt.value = "__ALL__";
  allOpt.textContent = "Vše dohromady";
  categoryEl.appendChild(allOpt);

  Object.keys(datasets).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    categoryEl.appendChild(opt);
  });

  categoryEl.value = "__ALL__";
}

function getAllWords(){
  return Object.values(datasets).flat();
}

function getActiveWords(){
  if (categoryEl.value === "__ALL__") return getAllWords();
  return datasets[categoryEl.value] || [];
}

function shuffle(arr){
  return arr.sort(() => Math.random() - 0.5);
}

function renderSetInfo(active){
  setCountEl.textContent = active.length;
  setNameEl.textContent = (categoryEl.value === "__ALL__") ? "VŠE DOHROMADY" : categoryEl.value;
}

function pickDifferentKey(fromKey){
  const candidates = KEYS.filter(k => k !== fromKey);
  return candidates[Math.floor(Math.random() * candidates.length)];
}

function setModeClassicVisibility(){
  if (quizTypeEl.value === "ultimate") {
    modeClassicEl.style.display = "none";
  } else {
    modeClassicEl.style.display = "";
  }
}

function buildRound(active){
  const quizType = quizTypeEl.value;

  currentItem = active[Math.floor(Math.random() * active.length)];

  if (quizType === "classic"){
    currentQKey = "en"; 
    currentAKey = modeClassicEl.value; 
  } else {
    currentQKey = KEYS[Math.floor(Math.random() * KEYS.length)];
    currentAKey = pickDifferentKey(currentQKey);
  }
}

function renderQuestion(){
  questionTextEl.textContent = currentItem[currentQKey];

  // info pilulky
  qTypeEl.textContent = LABELS[currentQKey];
  aTypeEl.textContent = LABELS[currentAKey];

  hintTextEl.textContent = `Vyber správný ${LABELS[currentAKey]} pro zadaný ${LABELS[currentQKey]}.`;
}

function buildOptions(active){
  let opts = [currentItem[currentAKey]];

  while (opts.length < 4){
    const candidate = active[Math.floor(Math.random() * active.length)][currentAKey];
    if (candidate && !opts.includes(candidate)) opts.push(candidate);
  }

  shuffle(opts);

  optionsEl.innerHTML = "";
  opts.forEach(text => {
    const btn = document.createElement("button");
    btn.className = "optionBtn";
    btn.textContent = text;
    btn.onclick = () => checkAnswer(text);
    optionsEl.appendChild(btn);
  });
}

function nextWord(){
  locked = false;
  resultEl.textContent = "";

  const active = getActiveWords();

  if (active.length < 4){
    questionTextEl.textContent = "Vybraná sada má méně než 4 položky.";
    optionsEl.innerHTML = "";
    qTypeEl.textContent = "–";
    aTypeEl.textContent = "–";
    hintTextEl.textContent = "";
    renderSetInfo(active);
    return;
  }

  buildRound(active);
  renderQuestion();
  buildOptions(active);
  renderSetInfo(active);
}

function checkAnswer(answer){
  if (locked) return;
  locked = true;

  const correctAnswer = currentItem[currentAKey];
  const buttons = document.querySelectorAll(".optionBtn");

  buttons.forEach(btn => {
    if (btn.textContent === correctAnswer) {
      btn.style.background = "#2ecc71"; 
    } else if (btn.textContent === answer) {
      btn.style.background = "#e74c3c"; 
    }
    btn.disabled = true;
  });

  if (answer === correctAnswer){
    correct++;
    resultEl.textContent = "Správně ✅";
  } else {
    wrong++;
    resultEl.textContent = "Špatně ❌ Správně: " + correctAnswer;
  }

  scoreEl.textContent = correct;
  wrongEl.textContent = wrong;

  setTimeout(nextWord, DELAY_MS);
}

function resetAll(){
  correct = 0;
  wrong = 0;
  scoreEl.textContent = 0;
  wrongEl.textContent = 0;
  nextWord();
}

resetBtnEl.onclick = resetAll;
categoryEl.onchange = resetAll;
quizTypeEl.onchange = () => { setModeClassicVisibility(); resetAll(); };
modeClassicEl.onchange = () => { if (quizTypeEl.value === "classic") nextWord(); };

// ====== Start ======
initCategories();
setModeClassicVisibility();
resetAll();
</script>

</body>
</html>
